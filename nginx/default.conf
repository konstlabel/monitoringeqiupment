# Define an upstream block named "app" pointing to the backend Spring Boot container
upstream app {
  server app:53828;
}

# Configure the HTTP server
server {
  listen 80;              # Listen on port 80 for HTTP requests
  server_name _;          # Default server for all hostnames

  # Health check or root response
  location = / {
    return 200 "API is up\n";             # Simple plain text response
    add_header Content-Type text/plain;   # Set the content type header
  }

  # Proxy all requests starting with /api/ to the backend application
  location /api/ {
    proxy_pass http://app;                                          # Pass to the "app" upstream
    proxy_http_version 1.1;                                         # Use HTTP/1.1 for keep-alive support
    proxy_set_header Host $host;                                    # Forward original host
    proxy_set_header X-Real-IP $remote_addr;                        # Forward client IP
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;    # Keep full client IP chain
    proxy_set_header X-Forwarded-Proto $scheme;                     # Forward protocol (http/https)
    proxy_set_header Connection "";                                 # Reset connection header to avoid issues
  }
}
